// fetch() to contact the network and retrieve resources
// try on jsonplaceholder.typicode.com


<!DOCTYPE html>
<html>
<head>
	<title>Fetch API Example</title>
</head>
<body>

<script>


	const r = fetch('https://jsonplaceholder.typicode.com/users')
	.then(r => {
		console.log(r) // Response (type, url, body...)
		r.text()
	})
	.then(body => console.log(body)) // body as text


	async function fetchUsers () {
		// get users after waiting for the response from fetch
		const r_json = await fetch('https://jsonplaceholder.typicode.com/users', {
			headers: {
				"Accept": "application/json"
			},
			method: 'GET'
		})
		if (r_json.ok) {
			// const users = await r_json.json() // parse body as json
			// console.log(users)
			// or <=>
			return r_json.json()
		}
		throw new Error('Network response was not ok.');
	}

	fetchUsers().then(users => console.log(users))
		.catch(error => console.error('Fetch error:', error));

	function postSmth() {
		const p = fetch('https://jsonplaceholder.typicode.com/posts', {
			method: 'POST',
			headers: {
				"Accept": "application/json",
				"Content-Type": "application/json"
			},
			body: JSON.stringify({		// method converts a JS object to a JSON string
				title: 'foo',
				body: 'bar',
				userId: 1
			})
		})
		if (p.ok) {
			return p.json();
		} else {
			console.error('HTTP-Error: ' + p.status);
		}
	}

	postSmth().then(post => console.log(post))
		.catch(error => console.error('Fetch error:', error));

	// ---

	// Create an AbortController which allows us to cancel the fetch requests with a signal
	const a = new AbortController();
	Promise.race([
		fetch('https://jsonplaceholder.typicode.com/posts/?_limit=5&_delay=2000', { signal: a.signal }),
		fetch('https://jsonplaceholder.typicode.com/users/?_limit=3', { signal: a.signal })
	])
	.then(r => r.json().then(body =>{
		a.abort()	  // cancel the slowest fetch request (posts)
		console.log(body)
	}))
	.catch(error => console.error('Fetch error:', error));

</script>

</body>
</html>
